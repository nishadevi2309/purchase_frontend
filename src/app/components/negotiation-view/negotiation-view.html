<div class="view-container">
  <div class="header">
    <h2>Negotiation Details #{{ negotiationId }}</h2>
    <div class="header-buttons">
      <button class="btn btn-edit" (click)="editNegotiation()">
        <i class="fas fa-edit"></i> Edit
      </button>
      <button class="btn-back" (click)="backToList()">
        <i class="fas fa-list"></i> Back to List
      </button>
    </div>
  </div>

  <div *ngIf="isLoading" class="loading">
    <i class="fas fa-spinner fa-spin fa-2x"></i>
    <p>Loading negotiation details...</p>
  </div>

  <div *ngIf="errorMessage" class="alert alert-error">
    <i class="fas fa-exclamation-circle"></i> {{ errorMessage }}
  </div>

  <div *ngIf="!isLoading && negotiation" class="details-grid">
    <!-- Negotiation Info Card -->
    <div class="card">
      <h3><i class="fas fa-handshake"></i> Negotiation Information</h3>
      <div class="card-content">
        <div class="detail-row">
          <span class="label">Negotiation ID:</span>
          <span class="value">NEG-{{ negotiation.negotiationid }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Status:</span>
          <span class="value">
            <span class="status-badge" [ngClass]="getStatusClass(negotiation.negotiationstatus)">
              {{ negotiation.negotiationstatus }}
            </span>
          </span>
        </div>
        <div class="detail-row">
          <span class="label">Negotiation Date:</span>
          <span class="value">{{ negotiation.negotiationDate | date:'dd/MM/yyyy' }}</span>
        </div>
      </div>
    </div>

    <!-- Purchase Request Info Card -->
    <div class="card" *ngIf="negotiation.purchaseRequest">
      <h3><i class="fas fa-file-invoice"></i> Purchase Request</h3>
      <div class="card-content">
        <div class="detail-row">
          <span class="label">PR ID:</span>
          <span class="value">PR-{{ negotiation.purchaseRequest?.prId || 'N/A' }}</span>
        </div>
        <div class="detail-row">
          <span class="label">PR Status:</span>
          <span class="value">{{ negotiation.purchaseRequest.prstatus }}</span>
        </div>
      </div>
    </div>

    <!-- Vendor & Event Info Card -->
    <div class="card">
      <h3><i class="fas fa-building"></i> Vendor & Event Details</h3>
      <div class="card-content">
        <div class="detail-row">
          <span class="label">Event ID:</span>
          <span class="value">{{ negotiation.eventid }} - {{ getEventName(negotiation.eventid) }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Vendor ID:</span>
          <span class="value">{{ negotiation.vendorid }} - {{ getVendorName(negotiation.vendorid) }}</span>
        </div>
      </div>
    </div>

    <!-- Financial Info Card -->
    <div class="card highlight-card">
      <h3><i class="fas fa-rupee-sign"></i> Financial Details</h3>
      <div class="card-content">
        <div class="detail-row">
          <span class="label">Initial Quote:</span>
          <span class="value amount">₹{{ negotiation.initialquoteamount | number:'1.2-2' }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Final Quote:</span>
          <span class="value amount">
            <span *ngIf="negotiation.finalquoteamount">
              ₹{{ negotiation.finalquoteamount | number:'1.2-2' }}
            </span>
            <span *ngIf="!negotiation.finalquoteamount" class="pending-text">Pending</span>
          </span>
        </div>
        <div class="detail-row savings-row" *ngIf="negotiation.finalquoteamount">
          <span class="label">Savings:</span>
          <span class="value savings-value">
            ₹{{ calculateSavings() | number:'1.2-2' }}
            <span class="percentage">({{ calculateSavingsPercentage() | number:'1.1-1' }}%)</span>
          </span>
        </div>
      </div>
    </div>

    <!-- Comments/Description Card -->
    <div class="card" *ngIf="negotiation.comments">
      <h3><i class="fas fa-comments"></i> Negotiation Comments</h3>
      <div class="card-content">
        <div class="detail-row comments-section">
          <span class="label">Description:</span>
          <div class="comments-content">{{ negotiation.comments }}</div>
        </div>
      </div>
    </div>
  </div>
</div>